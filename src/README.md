# `grpc/src` overview

The package ships the native code that bridges R with the gRPC C core.
The key translation units are:

- `client.cpp` – performs unary RPC calls from R. It constructs a
  `grpc_channel`, builds batches of client operations, waits on a completion
  queue, and returns the raw response payload to R.
- `server.cpp` – exposes a request loop that dispatches incoming RPCs back to
  R callbacks. It creates a gRPC server, completion queue, receives metadata
  and messages, and sends responses/status codes.
- `onload.c` – initialises and shuts down the gRPC library when the package is
  loaded/unloaded.
- `RcppExports.cpp` and `rcpp_hello.cpp` – boilerplate generated by Rcpp for
  registering the native routines exposed to R.

## Updated channel and server initialisation

gRPC 1.51+ removed the legacy `grpc_insecure_channel_create()` and
`grpc_server_add_insecure_http2_port()` helpers. The package now creates
explicit insecure credentials via
`grpc_insecure_channel_credentials_create()`/`grpc_channel_create()` on the
client and `grpc_insecure_server_credentials_create()`/`grpc_server_add_http2_port()`
on the server. For older gRPC toolchains the client falls back to
`grpc_insecure_channel_create()` when `GRPC_HAVE_GRPC_CHANNEL_CREATE` evaluates
to a true-ish value (the macro defaults to `1` so legacy headers continue to
compile). Setting `-DGRPC_HAVE_GRPC_CHANNEL_CREATE=0` in
`PKG_CXXFLAGS` surfaces a compile-time diagnostic that points builders at
`grpc_version_string()` when neither insecure helper is available, matching the
new compile-time error message in `client.cpp`.

## Building the shared object

Building the C/C++ sources requires gRPC, protobuf, and the R dependencies
declared in `DESCRIPTION` (`Rcpp`, `RProtoBuf`, and `futile.logger`). Once the
system libraries are available, the sources can be compiled by installing the
package from the repository root:

```sh
R CMD INSTALL --preclean .
```

This command builds `src/grpc.so` and installs it into the active R library,
triggering the gRPC client/server compilation in the process.
