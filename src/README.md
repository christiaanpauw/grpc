# `grpc/src` overview

The package ships the native code that bridges R with the gRPC C core.
The key translation units are:

- `client.cpp` – performs unary RPC calls from R. It constructs a
  `grpc_channel`, builds batches of client operations, waits on a completion
  queue, and returns the raw response payload to R.
- `server.cpp` – exposes a request loop that dispatches incoming RPCs back to
  R callbacks. It creates a gRPC server, completion queue, receives metadata
  and messages, and sends responses/status codes.
- `onload.c` – initialises and shuts down the gRPC library when the package is
  loaded/unloaded.
- `RcppExports.cpp` and `rcpp_hello.cpp` – boilerplate generated by Rcpp for
  registering the native routines exposed to R.

## Updated channel and server initialisation

gRPC 1.51+ removed the legacy `grpc_insecure_channel_create()` and
`grpc_server_add_insecure_http2_port()` helpers. The package now creates
explicit insecure credentials via `grpc_insecure_credentials_create()` and
`grpc_insecure_server_credentials_create()` before invoking
`grpc_channel_create()`/`grpc_server_add_http2_port()`. This keeps the package
compatible with modern gRPC releases while still targeting plaintext
connections by default.

## Building the shared object

Building the C/C++ sources requires gRPC, protobuf, and the R dependencies
declared in `DESCRIPTION` (`Rcpp`, `RProtoBuf`, and `futile.logger`). Once the
system libraries are available, the sources can be compiled by installing the
package from the repository root:

```sh
R CMD INSTALL --preclean .
```

This command builds `src/grpc.so` and installs it into the active R library,
triggering the gRPC client/server compilation in the process.
